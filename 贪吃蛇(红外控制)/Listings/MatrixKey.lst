C51 COMPILER V9.54   MATRIXKEY                                                             11/28/2025 11:45:53 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MATRIXKEY
OBJECT MODULE PLACED IN .\Objects\MatrixKey.obj
COMPILER INVOKED BY: E:\Keil_v5\C51\BIN\C51.EXE MatrixKey.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\MatrixKey.lst) OBJECT(.\Objects\MatrixKey.obj)

line level    source

   1          #include <STC89C5xRC.H>
   2          #include "Delay.h"
   3          
   4          /**
   5             * @brief çŸ©é˜µé”®ç›˜è¯»å–æŒ‰é”®é”®ç 
   6             * @param     æ— 
   7             * @retval KeyNumber æŒ‰ä¸‹æŒ‰é”®çš„é”®ç å€¼
   8             å¦‚æœæŒ‰é”®æŒ‰ä¸‹ä¸æ”¾ï¼Œç¨‹åºä¼šåœç•™åœ¨æ­¤å‡½æ•°ï¼Œæ¾æ‰‹çš„ä¸€ç¬é—´ï¼Œè¿”å›æŒ‰é”®é”®ç ï¼Œæ²¡æ
             -œ‰æŒ‰é”®æŒ‰ä¸‹æ—¶ï¼Œè¿”å›0
   9             */
  10          unsigned char MatrixKey()
  11          {
  12   1              unsigned char KeyNumber = 0;
  13   1              
  14   1              P1 = 0xff;
  15   1              P17 = 0;
  16   1              if(P13 == 0) { Delayms(20); while(P13 == 0); Delayms(20); KeyNumber = 1; }
  17   1              if(P12 == 0) { Delayms(20); while(P12 == 0); Delayms(20); KeyNumber = 2; }
  18   1              if(P11 == 0) { Delayms(20); while(P11 == 0); Delayms(20); KeyNumber = 3; }
  19   1              if(P10 == 0) { Delayms(20); while(P10 == 0); Delayms(20); KeyNumber = 4; }
  20   1              
  21   1              P1 = 0xff;
  22   1              P16 = 0;
  23   1              if(P13 == 0) { Delayms(20); while(P13 == 0); Delayms(20); KeyNumber = 5; }
  24   1              if(P12 == 0) { Delayms(20); while(P12 == 0); Delayms(20); KeyNumber = 6; }
  25   1              if(P11 == 0) { Delayms(20); while(P11 == 0); Delayms(20); KeyNumber = 7; }
  26   1              if(P10 == 0) { Delayms(20); while(P10 == 0); Delayms(20); KeyNumber = 8; }
  27   1              
  28   1              P1 = 0xff;
  29   1              P15 = 0;
  30   1              if(P13 == 0) { Delayms(20); while(P13 == 0); Delayms(20); KeyNumber = 9; }
  31   1              if(P12 == 0) { Delayms(20); while(P12 == 0); Delayms(20); KeyNumber = 10; }
  32   1              if(P11 == 0) { Delayms(20); while(P11 == 0); Delayms(20); KeyNumber = 11; }
  33   1              if(P10 == 0) { Delayms(20); while(P10 == 0); Delayms(20); KeyNumber = 12; }
  34   1              
  35   1              P1 = 0xff;
  36   1              P14 = 0;
  37   1              if(P13 == 0) { Delayms(20); while(P13 == 0); Delayms(20); KeyNumber = 13; }
  38   1              if(P12 == 0) { Delayms(20); while(P12 == 0); Delayms(20); KeyNumber = 14; }
  39   1              if(P11 == 0) { Delayms(20); while(P11 == 0); Delayms(20); KeyNumber = 15; }
  40   1              if(P10 == 0) { Delayms(20); while(P10 == 0); Delayms(20); KeyNumber = 16; }
  41   1              
  42   1              return KeyNumber;
  43   1      }
  44          
  45          unsigned char KeyDown()
  46          {
  47   1              char a = 0;
  48   1              unsigned char KeyValue = 0;
  49   1              P1 = 0x0f;
  50   1              if(P1 != 0x0f)  // è¯»å–æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹
  51   1              {
  52   2                      Delayms(10);
  53   2                      if(P1 != 0x0f)
C51 COMPILER V9.54   MATRIXKEY                                                             11/28/2025 11:45:53 PAGE 2   

  54   2                      {
  55   3                              // æµ‹è¯•åˆ—
  56   3                              P1 = 0x0f;
  57   3                              switch(P1)
  58   3                              {
  59   4                                      case(0x07): KeyValue = 1; break;
  60   4                                      case(0x0b): KeyValue = 2; break;
  61   4                                      case(0x0d): KeyValue = 3; break;
  62   4                                      case(0x0e): KeyValue = 4; break;
  63   4                              }
  64   3                              // æµ‹è¯•è¡Œ
  65   3                              P1 = 0xf0;
  66   3                              switch(P1)
  67   3                              {
  68   4                                      case(0x70): KeyValue = KeyValue; break;
  69   4                                      case(0xB0): KeyValue += 4; break;
  70   4                                      case(0xD0): KeyValue += 8; break;
  71   4                                      case(0xe0): KeyValue += 12; break;
  72   4                              }
  73   3                              while((a < 50) && (P1 != 0xf0)) // æ£€æµ‹æŒ‰é”®æ¾æ‰‹æ£€æµ‹
  74   3                              {
  75   4                                      Delayms(10);
  76   4                                      a++;
  77   4                              }
  78   3                      }
  79   2              }
  80   1              return KeyValue;
  81   1      }
  82          
  83          unsigned char Key_KeyNumber;
  84          
  85          unsigned char SnakeKey()
  86          {
  87   1              unsigned char KeyNumber = 0;
  88   1              P1 = 0xff;
  89   1              P15 = 0;
  90   1              if(P11 == 0) KeyNumber = 1;
  91   1              P1 = 0xff;
  92   1              P14 = 0;
  93   1              if(P11 == 0) KeyNumber = 2;
  94   1              if(P12 == 0) KeyNumber = 3;
  95   1              if(P10 == 0) KeyNumber = 4;
  96   1              return KeyNumber;
  97   1      }
  98          
  99          void LoopMatrixKey()
 100          {
 101   1              static unsigned char LastKey = 0, NowKey = 0;
 102   1              LastKey = NowKey;
 103   1              NowKey = SnakeKey();
 104   1              if(LastKey == 0 && NowKey == 1) Key_KeyNumber = 1;
 105   1              if(LastKey == 0 && NowKey == 2) Key_KeyNumber = 2;
 106   1              if(LastKey == 0 && NowKey == 3) Key_KeyNumber = 3;
 107   1              if(LastKey == 0 && NowKey == 4) Key_KeyNumber = 4;
 108   1      }
 109          
 110          unsigned char Key()
 111          {
 112   1              unsigned char temp;
 113   1              temp = Key_KeyNumber;
 114   1              Key_KeyNumber = 0;
 115   1              return temp;
C51 COMPILER V9.54   MATRIXKEY                                                             11/28/2025 11:45:53 PAGE 3   

 116   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    624    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
