C51 COMPILER V9.54   MAIN                                                                  11/28/2025 10:35:20 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          /*************************
   2          *名称：51单片机贪吃蛇（普中板子）
   3          *操作方式：按键KeyNum=11上，KeyNum=15下，KeyNum=14左，KeyNum=16右
   4          *作者：科技骨(Bilibil)
   5          *单片机交流QQ群：883948120
   6          **************************/
   7          #include <stdlib.h>
   8          #include <REGX52.H>
   9          #include "HC595.H"
  10          #include "Delay.H"
  11          #include "MatrixKey.H"
  12          #include "Timer0.H"
  13          #include "LCD1602.H"
  14          unsigned char Dire,KeyNum,length,foodx,foody,Speed=30;
  15          char Snakex[40]={0};//蛇身x坐标
  16          char Snakey[40]={0};//蛇身y坐标
  17          unsigned char code Coorx[]={0x7f,0xbf,0xdf,0xef,0xf7,0xfb,0xfd,0xfe};
  18          unsigned char code Coory[]={0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01};
  19          void SnakeMove()//蛇身移动
  20          {       unsigned char i;
  21   1          for (i=length+1;i>0;i--)
  22   1          {
  23   2              Snakex[i]=Snakex[i-1];
  24   2              Snakey[i]=Snakey[i-1];
  25   2          }   
  26   1              switch(Dire)    //Dire：方向（1：左 2：右 3：下 4：上）
  27   1              {
  28   2                      case 1:(Snakex[0])--;if((Snakex[0])<0){(Snakex[0])=7;}break;
  29   2                      case 2:(Snakex[0])++;(Snakex[0])%=8;break;
  30   2                      case 3:(Snakey[0])++;(Snakey[0])%=8;break;
  31   2                      case 4:(Snakey[0])--;if((Snakey[0])<0){(Snakey[0])=7;}break;
  32   2              }
  33   1      }
  34          void Scan_Key() //检测按键改变方向
  35          {
  36   1              if(KeyNum)
  37   1              {
  38   2                      switch(KeyNum)
  39   2                      {
  40   3                              case 1:if(Dire!=3)Dire=4;break;
  41   3                              case 2:if(Dire!=4)Dire=3;break;
  42   3                              case 3:if(Dire!=2)Dire=1;break;
  43   3                              case 4:if(Dire!=1)Dire=2;break;
  44   3                      }
  45   2              }
  46   1      }
  47          void food()//食物坐标
  48          {       
  49   1              foodx=(rand()+Snakex[length-1])%8;
  50   1              foody=(rand()+Snakex[length-1])%8;
  51   1      }
  52          void PlaySnakeAC()//刷新蛇、食物动画
  53          {
  54   1              unsigned char i;
C51 COMPILER V9.54   MAIN                                                                  11/28/2025 10:35:20 PAGE 2   

  55   1              for(i=0;i<length;i++)
  56   1              {
  57   2              MatrixLed(Coorx[Snakex[i]],Coory[Snakey[i]]);
  58   2              MatrixLed(Coorx[foodx],Coory[foody]);
  59   2              }
  60   1      }
  61          void Snakedead()//判断死亡，游戏结束
  62          {       unsigned char i;
  63   1              for(i=4;i<length;i++)
  64   1              {
  65   2                      if(Snakex[0]==Snakex[i] && Snakey[0]==Snakey[i])//蛇头撞到自己，游戏结束
  66   2                      {
  67   3                              P0=0xFF;
  68   3                              while(1);               
  69   3                      }
  70   2              }
  71   1      }
  72          void Play_Game()
  73          {       unsigned char i;
  74   1              Scan_Key();
  75   1              PlaySnakeAC();
  76   1              Snakedead();
  77   1              for(i=0;i<length;i++)//扫描是否吃到食物
  78   1              {       
  79   2                      if(foodx==Snakex[i] && foody==Snakey[i])
  80   2                      {
  81   3                              length++;
  82   3                              food();
  83   3                      }
  84   2              }
  85   1      }
  86          void main()
  87          {       
  88   1              Timer0_Init();
  89   1              length=1;               //初始化长度
  90   1              Dire=3;                 //初始化方向：下
  91   1              while(1)
  92   1              {       rand();
  93   2                      KeyNum=Key();
  94   2                      Play_Game();
  95   2              }
  96   1      }
  97          
  98          void Routine_Timer0()interrupt 1
  99          {
 100   1              static unsigned int T0Count1,T0Count2;
 101   1              TL0 = 0xCD;             
 102   1              TH0 = 0xD4;                     
 103   1              T0Count1++;
 104   1              if(T0Count1>=15)
 105   1              {
 106   2                      T0Count1=0;
 107   2                      Loop_MatrixKey();
 108   2              }
 109   1              T0Count2++;
 110   1              if(T0Count2>Speed)
 111   1              {       
 112   2                      T0Count2=0;
 113   2                      SnakeMove();
 114   2              }
 115   1      
 116   1      }
C51 COMPILER V9.54   MAIN                                                                  11/28/2025 10:35:20 PAGE 3   

 117          
 118          
 119          
 120          
 121          
 122          
 123          
 124          
 125          
 126          
 127          
 128          
 129          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    531    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     90       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
