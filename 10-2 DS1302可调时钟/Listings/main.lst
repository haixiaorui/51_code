C51 COMPILER V9.54   MAIN                                                                  11/27/2025 21:08:58 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <STC89C5xRC.H>
   2          #include "LCD1602.h"
   3          #include "DS1302.h"
   4          #include "key.h"
   5          #include "Timer0.h"
   6          
   7          unsigned char KeyNum, MODE, TimeSetSelect, TimeSetFlashFlag;
   8          
   9          void TimeShow(void)
  10          {
  11   1              DS1302_ReadTime();
  12   1              LCD_ShowNum(1, 1, DS1302_Time[0], 2);
  13   1              LCD_ShowNum(1, 4, DS1302_Time[1], 2);
  14   1              LCD_ShowNum(1, 7, DS1302_Time[2], 2);
  15   1              LCD_ShowNum(2, 1, DS1302_Time[3], 2);
  16   1              LCD_ShowNum(2, 4, DS1302_Time[4], 2);
  17   1              LCD_ShowNum(2, 7, DS1302_Time[5], 2);
  18   1      }
  19          
  20          void TimeSet(void)
  21          {
  22   1              if(KeyNum == 2)
  23   1              {
  24   2                      TimeSetSelect++;
  25   2                      TimeSetSelect %= 6;
  26   2              }
  27   1              if(KeyNum == 3)
  28   1              {
  29   2                      DS1302_Time[TimeSetSelect]++;
  30   2                      if(DS1302_Time[0] > 99) DS1302_Time[0] = 0;
  31   2                      if(DS1302_Time[1] > 12) DS1302_Time[1] = 1;
  32   2                      if(DS1302_Time[1] == 1 || DS1302_Time[1] == 3 || DS1302_Time[1] == 5 || DS1302_Time[1] == 7 
  33   2                              || DS1302_Time[1] == 8 || DS1302_Time[1] == 10 || DS1302_Time[1] == 12)
  34   2                      {
  35   3                              if(DS1302_Time[2] > 31) DS1302_Time[2] = 1;
  36   3                      }
  37   2                      else if(DS1302_Time[1] == 4 || DS1302_Time[1] == 6 || DS1302_Time[1] == 9 || DS1302_Time[1] == 11)
  38   2                      {
  39   3                              if(DS1302_Time[2] > 30) DS1302_Time[2] = 1;
  40   3                      }
  41   2                      else if(DS1302_Time[1] == 2)
  42   2                      {
  43   3                              if((DS1302_Time[0] % 4 == 0 && DS1302_Time[0] % 100 != 0) || DS1302_Time[0] % 400 == 0)
  44   3                              {
  45   4                                      if(DS1302_Time[2] > 29) DS1302_Time[2] = 1;
  46   4                              }
  47   3                              else
  48   3                              {
  49   4                                      if(DS1302_Time[2] > 28) DS1302_Time[2] = 1;
  50   4                              }
  51   3                      }
  52   2                      if(DS1302_Time[3] > 23) DS1302_Time[3] = 0;
  53   2                      if(DS1302_Time[4] > 59) DS1302_Time[4] = 0;
  54   2                      if(DS1302_Time[5] > 59) DS1302_Time[5] = 0;
C51 COMPILER V9.54   MAIN                                                                  11/27/2025 21:08:58 PAGE 2   

  55   2              }
  56   1              if(KeyNum == 4)
  57   1              {
  58   2                      DS1302_Time[TimeSetSelect]--;
  59   2                      if(DS1302_Time[0] < 0) DS1302_Time[0] = 99;
  60   2                      if(DS1302_Time[1] < 1) DS1302_Time[1] = 12;
  61   2                      if(DS1302_Time[1] == 1 || DS1302_Time[1] == 3 || DS1302_Time[1] == 5 || DS1302_Time[1] == 7 
  62   2                              || DS1302_Time[1] == 8 || DS1302_Time[1] == 10 || DS1302_Time[1] == 12)
  63   2                      {
  64   3                              if(DS1302_Time[2] < 1) DS1302_Time[2] = 31;
  65   3                              if(DS1302_Time[2] > 31) DS1302_Time[2] = 1;
  66   3                      }
  67   2                      else if(DS1302_Time[1] == 4 || DS1302_Time[1] == 6 || DS1302_Time[1] == 9 || DS1302_Time[1] == 11)
  68   2                      {
  69   3                              if(DS1302_Time[2] < 1) DS1302_Time[2] = 30;
  70   3                              if(DS1302_Time[2] > 30) DS1302_Time[2] = 1;
  71   3                      }
  72   2                      else if(DS1302_Time[1] == 2)
  73   2                      {
  74   3                              if((DS1302_Time[0] % 4 == 0 && DS1302_Time[0] % 100 != 0) || DS1302_Time[0] % 400 == 0)
  75   3                              {
  76   4                                      if(DS1302_Time[2] < 1) DS1302_Time[2] = 29;
  77   4                                      if(DS1302_Time[2] > 29) DS1302_Time[2] = 1;
  78   4                              }
  79   3                              else
  80   3                              {
  81   4                                      if(DS1302_Time[2] < 1) DS1302_Time[2] = 28;
  82   4                                      if(DS1302_Time[2] > 28) DS1302_Time[2] = 1;
  83   4                              }
  84   3                      }
  85   2                      if(DS1302_Time[3] < 0) DS1302_Time[3] = 23;
  86   2                      if(DS1302_Time[4] < 0) DS1302_Time[4] = 59;
  87   2                      if(DS1302_Time[5] < 0) DS1302_Time[5] = 59;
  88   2              }
  89   1              if(TimeSetSelect == 0 && TimeSetFlashFlag == 1) LCD_ShowString(1, 1, "  ");
  90   1              else LCD_ShowNum(1, 1, DS1302_Time[0], 2);
  91   1              if(TimeSetSelect == 1 && TimeSetFlashFlag == 1) LCD_ShowString(1, 4, "  ");
  92   1              else LCD_ShowNum(1, 4, DS1302_Time[1], 2);
  93   1              if(TimeSetSelect == 2 && TimeSetFlashFlag == 1) LCD_ShowString(1, 7, "  ");
  94   1              else LCD_ShowNum(1, 7, DS1302_Time[2], 2);
  95   1              if(TimeSetSelect == 3 && TimeSetFlashFlag == 1) LCD_ShowString(2, 1, "  ");
  96   1              else LCD_ShowNum(2, 1, DS1302_Time[3], 2);
  97   1              if(TimeSetSelect == 4 && TimeSetFlashFlag == 1) LCD_ShowString(2, 4, "  ");
  98   1              else LCD_ShowNum(2, 4, DS1302_Time[4], 2);
  99   1              if(TimeSetSelect == 5 && TimeSetFlashFlag == 1) LCD_ShowString(2, 7, "  ");
 100   1              else LCD_ShowNum(2, 7, DS1302_Time[5], 2);
 101   1      }
 102          
 103          void main()
 104          {
 105   1          LCD_Init();
 106   1              DS1302_Init();
 107   1              Timer0_Init();
 108   1              LCD_ShowString(1, 1, "  -  -  ");
 109   1              LCD_ShowString(2, 1, "  :  :  ");
 110   1              
 111   1              DS1302_SetTime();
 112   1              
 113   1          while(1)
 114   1          {
 115   2                      KeyNum = Key();
 116   2                      if(KeyNum == 1)
C51 COMPILER V9.54   MAIN                                                                  11/27/2025 21:08:58 PAGE 3   

 117   2                      {
 118   3                              if(MODE == 0) 
 119   3                              {
 120   4                                      MODE = 1;
 121   4                                      TimeSetSelect = 0;
 122   4                              }
 123   3                              else if(MODE == 1)
 124   3                              {
 125   4                                      MODE = 0;
 126   4                                      DS1302_SetTime();
 127   4                              }
 128   3                      }
 129   2                      switch(MODE)
 130   2                      {
 131   3                              case 0: TimeShow(); break;
 132   3                              case 1: TimeSet(); break;
 133   3                      }
 134   2          }
 135   1      }
 136          
 137          void Timer0_Routine() interrupt 1
 138          {
 139   1              static unsigned int T0count;
 140   1              TH0 = 64535 / 256;
 141   1              TL0 = 64535 % 256;
 142   1              T0count++;
 143   1              if(T0count >= 200)
 144   1              {
 145   2                      T0count = 0;
 146   2                      TimeSetFlashFlag = !TimeSetFlashFlag;
 147   2              }
 148   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1036    ----
   CONSTANT SIZE    =     21    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
