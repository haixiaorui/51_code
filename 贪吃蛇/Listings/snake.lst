C51 COMPILER V9.54   SNAKE                                                                 11/29/2025 10:28:31 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE SNAKE
OBJECT MODULE PLACED IN .\Objects\snake.obj
COMPILER INVOKED BY: E:\Keil_v5\C51\BIN\C51.EXE snake.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\sna
                    -ke.lst) OBJECT(.\Objects\snake.obj)

line level    source

   1          #include <stdlib.h>
   2          #include <STC89C5xRC.H>
   3          #include "MatrixLED.h"
   4          #include "MatrixKey.h"
   5          
   6          unsigned char snakeX[40] = {1};
   7          unsigned char snakeY[40] = {1};
   8          
   9          unsigned char snake_size, snake_dir, KeyNum, foodX, foodY;
  10          
  11          void SnakeLedShow(unsigned char x, unsigned char y)
  12          {
  13   1              switch(x)
  14   1              {
  15   2                      case 1:
  16   2                              MatrixLED_ShowColumn(y-1, 0x80);
  17   2                              break;
  18   2                      case 2:
  19   2                              MatrixLED_ShowColumn(y-1, 0x40);
  20   2                              break;
  21   2                      case 3:
  22   2                              MatrixLED_ShowColumn(y-1, 0x20);
  23   2                              break;
  24   2                      case 4:
  25   2                              MatrixLED_ShowColumn(y-1, 0x10);
  26   2                              break;
  27   2                      case 5:
  28   2                              MatrixLED_ShowColumn(y-1, 0x08);
  29   2                              break;
  30   2                      case 6:
  31   2                              MatrixLED_ShowColumn(y-1, 0x04);
  32   2                              break;
  33   2                      case 7:
  34   2                              MatrixLED_ShowColumn(y-1, 0x02);
  35   2                              break;
  36   2                      case 8:
  37   2                              MatrixLED_ShowColumn(y-1, 0x01);
  38   2                              break;
  39   2              }
  40   1      }
  41          
  42          void PlayDraw()
  43          {
  44   1              unsigned char i;
  45   1              for(i = 0; i < snake_size; i++) {
  46   2                      SnakeLedShow(snakeX[i], snakeY[i]);
  47   2              }
  48   1              SnakeLedShow(foodX, foodY);
  49   1      }
  50          
  51          void SnakeMove()
  52          {
  53   1              unsigned char i;
  54   1              // 0 1 2 3 上 右 下 左
C51 COMPILER V9.54   SNAKE                                                                 11/29/2025 10:28:31 PAGE 2   

  55   1              for(i = snake_size-1; i > 0; i--) {
  56   2                      snakeX[i] = snakeX[i-1];
  57   2                      snakeY[i] = snakeY[i-1];
  58   2              }
  59   1              switch(snake_dir)
  60   1              {
  61   2                      case 0:
  62   2                              snakeX[0]--;
  63   2                              if(snakeX[0] < 1) snakeX[0] = 8;
  64   2                              break;
  65   2                      case 1:
  66   2                              snakeY[0]++;
  67   2                              if(snakeY[0] > 8) snakeY[0] = 1;
  68   2                              break;
  69   2                      case 2:
  70   2                              snakeX[0]++;
  71   2                              if(snakeX[0] > 8) snakeX[0] = 1;
  72   2                              break;
  73   2                      case 3:
  74   2                              snakeY[0]--;
  75   2                              if(snakeY[0] < 1) snakeY[0] = 8;
  76   2                              break;
  77   2              }
  78   1      }
  79          
  80          void ScanKey()
  81          {
  82   1              if(KeyNum)
  83   1              {
  84   2                      switch(KeyNum)
  85   2                      {
  86   3                              case 1:
  87   3                                      if(snake_dir != 2) snake_dir = 0;
  88   3                                      break;
  89   3                              case 2:
  90   3                                      if(snake_dir != 0) snake_dir = 2;
  91   3                                      break;
  92   3                              case 3:
  93   3                                      if(snake_dir != 1) snake_dir = 3;
  94   3                                      break;
  95   3                              case 4:
  96   3                                      if(snake_dir != 3) snake_dir = 1;
  97   3                                      break;
  98   3                      }
  99   2              }
 100   1      }
 101          
 102          void FoodCreate()
 103          {
 104   1              foodX = ((rand()+snakeX[snake_size-1])%8)+1;
 105   1              foodY = ((rand()+snakeY[snake_size-1])%8)+1;
 106   1      }
 107          
 108          void EatFood()
 109          {
 110   1              if(snakeX[0] == foodX && snakeY[0] == foodY)
 111   1              {
 112   2                      snake_size++;
 113   2                      FoodCreate();
 114   2              }
 115   1      }
 116          
C51 COMPILER V9.54   SNAKE                                                                 11/29/2025 10:28:31 PAGE 3   

 117          void SnakeDie()
 118          {
 119   1              unsigned char i;
 120   1              for(i = 4; i < snake_size; i++) {
 121   2                      if(snakeX[0] == snakeX[i] && snakeY[0] == snakeY[i]) {
 122   3                              P0 = 0xff;
 123   3                              while(1);
 124   3                      }
 125   2              }
 126   1      }
 127          
 128          void GameInit()
 129          {
 130   1              snake_size = 2;
 131   1              snake_dir = 2;
 132   1              FoodCreate();
 133   1      }
 134          
 135          void PlayGame()
 136          {
 137   1              unsigned char i;
 138   1              rand();
 139   1              ScanKey();
 140   1              PlayDraw();
 141   1              SnakeDie();
 142   1              EatFood();
 143   1              KeyNum = Key();
 144   1              for(i = 0; i < snake_size; i++) {
 145   2                      if(foodX == snakeX[i] && foodY == snakeY[i]) {
 146   3                              FoodCreate();
 147   3                      }
 148   2              }
 149   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    476    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     85       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
